# Networking Guide
Guidance on Networking Technologies

## Comprehensive Summary of OSPF

1. **Basic Concepts and Functioning:**
   - OSPF is a link-state routing protocol used as an Interior Gateway Protocol (IGP).
   - Utilizes Dijkstra's algorithm for shortest-path first calculations.
   - Known for quick convergence and efficient routing based on the shortest path.

2. **OSPF Areas and Hierarchical Design:**
   - Multi-area OSPF enhances scalability and management of larger networks.
   - OSPF uses areas to reduce routing overhead and improve scalability.
   - Backbone area (Area 0) is central in OSPF's hierarchical design.
      - All areas have to be  connected to the backbone physically or via virtual links.
   - OSPF routers are categorized as backbone routers, area border routers (ABRs), and autonomous system boundary routers (ASBRs).

3. **Link-State Database and LSAs:**
   - Maintains a link-state database (LSDB) for storing network topology information.
   - Routers exchange link-state advertisements (LSAs) to update network topology.
   - Various LSA types (e.g., Type 1, Type 2, Type 3) serve different purposes in OSPF.
      - The router links are an indication of the state of the interfaces on a router in a certain designated area. Each router generates a router link for all of its interfaces.
      - Summary links are generated by ABRs; this is how network reachability information is disseminated between areas. Normally, all information is injected into the backbone (area 0) and in turn the backbone passes it on to other areas.
      - Network Links are generated by a Designated Router (DR) on a segment (DRs are discussed later). This information is an indication of all routers connected to a particular multi-access segment such as Ethernet, Token Ring and FDDI (NBMA also).
      - ABRs also propagate the reachability of the ASBR. This is how routers know how to get to external routes in other ASs.
      - External Links are an indication of networks outside of the AS. These networks are injected into OSPF via redistribution. The ASBR injects these routes into an autonomous system.

4. **Neighbor Relationships and Packet Types:**
   - OSPF establishes neighbor relationships using packets like Hello, Database Description (DBD), Link State Request (LSR), and Link State Update (LSU).
   - Designated Router (DR) and Backup Designated Router (BDR) roles in OSPF are crucial for efficient forwarding LSA in a multi-access and NBMA network.
     - On broadcast media and non-broadcast multi-access networks, a router becomes `Full` only with the DR and the BDR; it stays in the `2-Way` state with all other neighbors.

5. **Network Types:**
   - Multi-Access
     - Broadcast Multi-Access
     - Non-Broadcast Multi-Access
        - Avoid DRs and neighbor Command on NBMA
   - Point-to-Point
     - Point-to-Point Subinterfaces
   - Point-to-MultiPoint

6. **Route Summarization:**
   - Route summarization is important in OSPF, especially in multi-area setups.
   - Summarization definition: Consolidate multiple routes into one single advertisement.
      - This is normally done at the boundaries of Area Border Routers (ABRs).
   - Although summarization is configured between any two areas, it is better to summarize in the direction of the backbone. As a result, the backbone receives all the aggregate addresses and, in turn, injects them, already summarized, into other areas.
   - It is difficult to summarize if the subnets between two areas overlapped. The backbone area would receive summary ranges that overlap, and routers in the middle would not know where to send the traffic based on the summary address.

## OSPF Neighbors
- Routers that share a common segment become neighbors on that segment. Neighbors are elected via the Hello protocol`. Hello packets are sent periodically out of each interface through IP multicast 224.0.0.5.
- Routers become neighbors as soon as they see themselves listed in the neighbor Hello packet. This way, a two-way communication is guaranteed. Neighbor negotiation applies to the primary address only.
- Secondary addresses can be configured on an interface with a restriction that they have to belong to the same area as the primary address.
- Two routers do not become neighbors unless they agree with this criteria.
   - `Area-id`: Two routers which have a common segment; their interfaces have to belong to the same area on that segment. The interfaces must belong to the same subnet and have a similar mask.
   - `Authentication`: OSPF allows for the configuration of a password for a specific area. Routers that want to become neighbors have to exchange the same password on a particular segment.
   - `Hello` and `Dead` Intervals: OSPF exchanges Hello  packets on each segment. This is a form of keepalive used by routers in order to acknowledge their existence on a segment and in order to elect a designated router (DR) on multiaccess segments.
   - The `Hello` interval specifies the length of time, in seconds, between the Hello  packets that a router sends on an OSPF interface.
- The dead interval is the number of seconds that a router's `Hello` packets have not been seen before its neighbors declare the OSPF router down.
- OSPF requires these intervals to be exactly the same between two neighbors. If any of these intervals are different, these routers do not become neighbors on a particular segment. The router interface commands used to set these timers are: `ip ospf hello-interval seconds` and `ip ospf dead-interval seconds`.
- Stub area flag: Two routers also have to agree on the stub area flag in the Hello packets in order to become neighbors.

## OSPF Packet Types

1. **Hello Packets:**
   - **Purpose:** Establish and maintain neighbor relationships.
   - **Functionality:** Exchanged between OSPF routers on a network segment. Routers agree on parameters like Hello and Dead intervals.
   - **Key Features:** Contains OSPF router's ID, the network mask, and the interval timers. Also lists the router IDs of known neighbors.

2. **Database Description (DBD) Packets:**
   - **Purpose:** Exchange information about the OSPF link-state database between routers.
   - **Functionality:** Used during the initial synchronization of LSDBs between OSPF neighbors. 
   - **Key Features:** Contains descriptions of the router's LSAs but not the LSAs themselves. Helps neighbors to determine which LSAs are out of date or missing.

3. **Link-State Request (LSR) Packets:**
   - **Purpose:** Request more recent LSA information from OSPF neighbors.
   - **Functionality:** Sent when a router discovers, through DBD exchange, that it has outdated or missing LSAs.
   - **Key Features:** Specifies the LSAs that are needed. The receiving router responds with Link-State Update packets containing the requested LSAs.

4. **Link-State Update (LSU) Packets:**
   - **Purpose:** Propagate link-state information.
   - **Functionality:** Used to send LSAs to OSPF neighbors. These packets are the actual carriers of the topology information.
   - **Key Features:** Can carry multiple LSAs in a single packet. Critical for the OSPF flooding process, ensuring all routers have a consistent view of the network.

5. **Link-State Acknowledgment (LSAck) Packets:**
   - **Purpose:** Acknowledge receipt of LSU packets.
   - **Functionality:** Sent in response to LSU packets to confirm their receipt.
   - **Key Features:** Ensures reliable delivery of LSUs. Used in the OSPF flooding mechanism to confirm that LSAs have been successfully propagated.

Each of these packet types plays a specific role in OSPF's operation, from establishing neighbor relationships to ensuring routers have up-to-date and synchronized information about the network topology. Understanding these packet types is essential for comprehending OSPF's internal mechanics and for troubleshooting OSPF networks.

## OSPF Adjacency States
OSPF routers go through several states while forming adjacencies with other routers. Understanding these states is crucial for network troubleshooting and ensuring efficient OSPF operation.
1. **Down State:**
   - **Initial State:** The starting state of an OSPF adjacency.
   - **No Communication:** In this state, no Hello packets have been received from the neighbor.

2. **Attempt State:**
   - **Manual Neighbors:** This state is only used for manually configured neighbors in non-broadcast multi-access (NBMA) networks.
   - **Initial Contact:** Routers send unicast Hello packets to establish a connection.

3. **Init State:**
   - **Receiving Hello Packets:** The router has received a Hello packet from a neighbor, but its own router ID has not yet appeared in the neighbor's Hello packet.
   - **Partial Communication:** Indicates the beginning of bidirectional communication.

4. **Two-Way State:**
   - **Bidirectional Communication:** The router’s ID appears in the neighbor’s Hello packet, indicating two-way communication.
   - **DR/BDR Election:** In broadcast and non-broadcast multi-access (NBMA) networks, this state is necessary for the election of the Designated Router (DR) and Backup Designated Router (BDR).
   - **Decision to Form Adjacencies:** At this state, a router decides whether to form a full adjacency with this neighbor.
       - **Broadcast and NBMA Networks:** On broadcast and NBMA networks, a router forms a full adjacency only with the DR and BDR. It remains in the 2-way state with all other neighbors. In broadcast and NBMA environments, the role of the DR and BDR is critical to limiting the number of full adjacencies, thus optimizing OSPF's operation and resource utilization.
       - **Point-to-Point and Point-to-Multipoint Networks:** On point-to-point and point-to-multipoint networks, a router typically forms a full adjacency with all connected routers.

5. **ExStart State:**
   - **Master/Slave Relationship:** Routers establish a master-slave relationship to determine the order of DBD packet exchange.
   - **Initial Sequence Number:** The sequence number for the DBD exchange is established in this state.

6. **Exchange State:**
   - **DBD Packet Exchange:** Routers exchange Database Description (DBD) packets.
   - **LSDB Information:** DBD packets contain summaries of the router’s LSDB, allowing routers to identify missing or outdated LSAs.

7. **Loading State:**
   - **Requesting Missing LSAs:** Routers send Link-State Request (LSR) packets for any missing or outdated LSAs identified in the Exchange state.
   - **Receiving Updates:** The router receives the requested LSAs in Link-State Update (LSU) packets.

8. **Full State:**
   - **Complete Adjacency:** The LSDBs are fully synchronized between the two routers.
   - **Stable Routing Table:** Routers in the Full state have complete information to build a consistent and accurate routing table.

Understanding these states helps in diagnosing OSPF-related issues, as each state reflects a specific step in the process of forming a full OSPF adjacency. Proper progression through these states is essential for establishing reliable OSPF routes in a network.

## OSPF Building Adjacencies

1. **Initiating Adjacency Formation:**
   - **Hello Packets:** Adjacency formation begins with the exchange of OSPF Hello packets.
   - **Purpose:** These packets are used to discover OSPF neighbors and establish basic communication parameters.

2. **Neighbor Discovery:**
   - **Neighbor Identification:** Routers identify potential neighbors by receiving Hello packets.
   - **Parameter Matching:** Routers must agree on certain parameters (like area ID, subnet mask, Hello/Dead intervals) to form an adjacency.

3. **Two-Way Communication:**
   - **Two-Way State:** Once two OSPF routers see each other's router ID in the received Hello packets, they enter the two-way state.
   - **Role in Broadcast Networks:** In broadcast networks, this state is critical for the election of the Designated Router (DR) and Backup Designated Router (BDR).

4. **Database Exchange:**
   - **DBD Packets:** After reaching the two-way state, routers exchange Database Description (DBD) packets.
   - **LSDB Synchronization:** This step involves synchronizing their link-state database (LSDB). Routers identify missing or outdated LSAs.

5. **Requesting Missing Information:**
   - **Link-State Request (LSR):** Routers send LSR packets to request the missing or outdated LSAs from their neighbors.
   - **Exchange of Information:** Neighbors respond with Link-State Update (LSU) packets containing the requested LSAs.

6. **Full Adjacency:**
   - **State of Full Adjacency:** Once LSDBs are synchronized between two routers, they achieve a state of full adjacency.
   - **Importance:** Full adjacency is essential for OSPF routers to have a complete and consistent view of the network for accurate routing decisions.

7. **Maintaining Adjacencies:**
   - **Regular Hello Packets:** OSPF routers send regular Hello packets to maintain established adjacencies.
   - **Dead Interval:** If a router doesn't receive a Hello packet from a neighbor within the dead interval, the adjacency is considered broken.

8. **Special Considerations in Different Network Types:**
   - **Broadcast and Non-Broadcast Networks:** DR and BDR election processes impact adjacency formation.
   - **Point-to-Point Networks:** These networks typically have a simpler adjacency process due to the presence of only two routers on the network segment.

Understanding the process of building adjacencies in OSPF is crucial for network administrators, as it directly impacts the efficiency and stability of OSPF routing in a network. Properly formed adjacencies ensure optimal routing decisions and overall network performance.

## OSPF LSA Types
OSPF (Open Shortest Path First) utilizes various types of Link-State Advertisements (LSAs) to share routing and topology information. Each LSA type has a specific purpose, flooding scope, and rules for origination and propagation.

1. **Type 1: Router LSA**
   - **Flooding Scope:** Limited to the originating router's area.
   - **Purpose:** Describes the state of the router's interfaces in an area.
   - **Originating Routers:** Every router in an OSPF area generates this LSA for itself.

2. **Type 2: Network LSA**
   - **Flooding Scope:** Limited to the originating router's area.
   - **Purpose:** Describes the routers connected to a particular network, specifically broadcast and NBMA networks.
   - **Originating Routers:** Only the DR for a particular network segment originates this LSA.

3. **Type 3: Summary LSA**
   - **Flooding Scope:** Flooded to all areas in an OSPF domain except the originating area and stub areas.
   - **Purpose:** Advertises routes to networks in other areas.
   - **Originating Routers:** ABRs are responsible for generating these LSAs to summarize routes from one area to another.

4. **Type 4: ASBR-Summary LSA**
   - **Flooding Scope:** Similar to Type 3, flooded to all areas but not stub areas.
   - **Purpose:** Advertises the location of an Autonomous System Boundary Router (ASBR).
   - **Originating Routers:** Generated by ABRs, not the ASBR itself, to inform other areas about the presence of an ASBR.

5. **Type 5: External LSA**
   - **Flooding Scope:** Flooded to the entire OSPF domain, except stub and not-so-stubby areas (NSSAs).
   - **Purpose:** Advertises routes to networks external to the OSPF domain (external routes).
   - **Originating Routers:** Generated by ASBRs to propagate external routing information.

6. **Type 7: NSSA External LSA**
   - **Flooding Scope:** Limited to the Not-So-Stubby Area (NSSA) in which it is originated.
   - **Purpose:** Similar to Type 5, but used within an NSSA to advertise external routes.
   - **Originating Routers:** ASBRs within the NSSA originate these LSAs.

Each LSA type serves a distinct role in OSPF's operation, aiding in the dissemination of routing and topology information throughout an OSPF network. Understanding these LSA types is crucial for network administrators to effectively manage and troubleshoot OSPF networks.

## Area LSA Restriction

| Area                          | Restriction                                                                                                             |
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| Normal                        | None                                                                                                                    |
| Stub                          | No Type 4 or 5 AS-external LSAs allowed.                                                                                |
| Totally Stub (no-summary)     | No Type 3, 4 or 5 LSAs allowed except the default summary route.                                                        |
| NSSA                          | No Type 5 AS-external LSAs allowed, but Type 7 LSAs that convert to Type 5 at the NSSA ABR can traverse.                |
| NSSA Totally Stub (no-summary)| No Type 3, 4 or 5 LSAs except the default summary route, but Type 7 LSAs that convert to Type 5 at the NSSA ABR are allowed. |

## Troubleshooting OSPF (Open Shortest Path First) 
Here is the methodical approach to ensure effective troubleshooting OSPF:

- Is the interface up on the local router and neighboring router, with line protocol up? Enter the show interface command to check the interface status.
- Check for IP connectivity between the neighbor routers, as shown here:
   - Does the neighbor respond to a ping command? Ping the IP address assigned to the interface in question on the neighbor router. Enter the traceroute command to the same IP address and verify it takes no more than one hop to reach the destination.
   - Does the neighbor respond if you enter a ping 224.0.0.5 command? (224.0.0.5 is the IP address to which OSPF HELLOs are sent.)
   - Check for any inbound access lists or other devices (such as a switch) that can prohibit the IP packets to be forwarded from one neighbor to the other.
- Is OSPF enabled on both your interface and the interface of the neighbor/adjacent router? Enter the show ip ospf interface command to verify.
- Is OSPF configured as passive for the interface of the local or neighbor/adjacent router? Enter the show ip ospf interface command to verify HELLO packets are due to be sent out of the interface
- Verify that neighbor routers have different Router IDs. Router IDs are used to identify each router in an OSPF network. Routers with the same Router ID ignores HELLOs sent by each other, and not become adjacent. The first line of the show ip ospf command output displays the current Router ID of each router.
- Verify these HELLO parameters match on the neighbor interfaces:
   - OSPF area number - Enter the show ip ospf interface interface-name command to verify.
   - OSPF area type, such as stub or NSSA - Enter the show ip ospf command to verify.
   - Subnet and subnet mask - Enter the show interface command to verify.
   - OSPF HELLO and Dead timer values - Enter the show ip ospf interface interface-name command to verify.
   - Authentication
- If the problem is on a point-to-point link (such as PPP or High-Level Data Link Control [HDLC]) and there is more than one parallel link between this pair of routers, verify the lines are properly connected. Suppose you planned to connect interface Serial0/0 on one router with interface Serial0/0 on its neighbor and Serial1/0 with Serial1/0 on its neighbor, but you accidentally crossed them and connected Serial0/0 of each router with Serial1/0 on the other. The ping command cannot discover such a problem, but OSPF fails to establish adjacency. Use information provided by Cisco Discovery Protocol (CDP) to verify proper device interconnection. Enter the show cdp neighbor interface-name command to verify the name and PortID of a remote device match the network design.
- MTU mismatch or the receipt of an unexpected DBD sequence number.
- Check for Route Filtering**:
   - Ensure there are no filters or `route-maps` blocking OSPF routes.
- OSPF Stub Areas:
   - Ensure that there are no stub area mismatches. Routers in stub areas shouldn't receive external routes.
- Check for Network Type Mismatches**:
   - Different OSPF network types (like point-to-point, broadcast, etc.) might impact neighbor formation. Verify using `show ip ospf interface`.
- External Routes:
   - If OSPF external routes are missing, check redistribution configuration and ensure proper metrics and subnets are in place.

Always remember to approach troubleshooting methodically. Change one thing at a time, and always document any changes made. This ensures that new issues are not introduced during the troubleshooting process.


